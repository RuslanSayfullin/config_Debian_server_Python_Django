разработка Sayfullin RR
========================================================================================================================

// Руководство //
Первоначальная настройка сервера с Debian 11

Введение
У нас должен быть новый экземпляр сервера Debian 11 с базовым брандмауэром и пользователем без полномочий root с sudo 
настроенными привилегиями.
Вы можете узнать, как это настроить, изучив наше руководство по первоначальной настройке сервера:

Первоначальная настройка сервера с Debian 11.
Введение
    - Когда мы впервые создаем новый сервер Debian 11, есть несколько шагов по настройке, которые мы должны выполнить на 
    раннем этапе как часть базовой настройки. Это повысит безопасность и удобство использования нашего сервера и даст 
    прочную основу для последующих действий.
    - В этом руководстве мы узнаем, как войти на наш сервер в качестве пользователя root, создать нового пользователя с 
    правами администратора и настроить базовый брандмауэр.
Шаг 1 — Вход в систему как root:
    Чтобы войти на свой сервер, нам необходимо знать общедоступный IP-адрес нашего сервера. 
    Нам также потребуется пароль или, если мы установили ключ SSH для аутентификации, закрытый ключ для учетной записи 
    пользователя root.
        $ ssh root@your_server_ip -p 22
    Примите предупреждение о подлинности хоста, если оно появляется. Если вы используете аутентификацию по паролю, 
    укажите свой пароль root для входа в систему. Если вы используете ключ SSH, защищенный парольной фразой, 
    вам может быть предложено ввести парольную фразу при первом использовании ключа в каждом сеансе. 
    Если вы впервые входите на сервер с паролем, вам также может быть предложено изменить пароль root.
    Следующим шагом является настройка альтернативной учетной записи пользователя с ограниченной сферой влияния для 
    повседневной работы. Позже мы опишем, как получить повышенные привилегии в те моменты, когда они нам нужны.
Шаг 2 — Создание нового пользователя
    После того, как вошли в систему как root, мы готовы добавить новую учетную запись пользователя, 
    которую будем использовать для входа в систему с этого момента.
    В этом примере создается новый пользователь с именем sammy, его необходимо заменить на выбранное имя пользователя:
        # adduser sammy
    Будет задано несколько вопросов, начиная с пароля учетной записи.
    Ввести надежный пароль и, при желании, указать любую дополнительную информацию. 
    Это не обязательно, и можно просто нажать ENTER на любое поле, которое нужно пропустить.
    Далее настроим этого нового пользователя с правами администратора.
Шаг 3 — Предоставление административных привилегий
    Теперь мы создали новую учетную запись пользователя с обычными правами учетной записи. Однако иногда может 
    понадобиться выполнять с ним административные задачи.
    Чтобы не выходить из нашего обычного пользователя и снова входить в систему с учетной записью root,
    мы можем настроить так называемые привилегии суперпользователя или root для нашей обычной учетной записи.
    Это позволит обычному пользователю запускать команды с правами администратора, поставив слово sudo перед командой.
    Чтобы добавить эти привилегии новому пользователю, нужно добавить нового пользователя в группу sudo.
    По умолчанию в Debian 11 пользователям, принадлежащим к группе sudo, разрешено использовать эту sudo команду.
    От имени пользователя root выполните эту команду, чтобы добавить нового пользователя в группу sudo 
    (замените выделенное слово новым пользователем):
        # usermod -aG sudo sammy
    Теперь, когда вошли в систему как обычный пользователь, можно вводить sudo команды перед запуском команды с 
    правами суперпользователя.
Шаг 4 — Настройка базового брандмауэра
    Серверы Debian могут использовать брандмауэры, чтобы гарантировать, что разрешены только определенные подключения к
    определенным службам. В руководстве мы установим и будем использовать брандмауэр UFW для настройки политик 
    брандмауэра и управления исключениями.
    Мы можем использовать apt менеджер пакетов для установки UFW. Обновите локальный индекс, чтобы получить последнюю 
    информацию о доступных пакетах, а затем установите программное обеспечение брандмауэра UFW, набрав:
        # apt update
        # apt install ufw
    Профили брандмауэра позволяют UFW управлять именованными наборами правил брандмауэра для установленных приложений. 
    Профили для некоторых распространенных программ по умолчанию связаны с UFW, и пакеты могут регистрировать
    дополнительные профили в UFW в процессе установки. OpenSSH, служба, позволяющая нам сейчас подключаться к нашему 
    серверу, имеет профиль брандмауэра, который мы можем использовать.
    Вы перечисляете все доступные профили приложений, набрав:
        # ufw app list
    Нам нужно убедиться, что брандмауэр разрешает SSH-соединения, чтобы мы могли снова войти в систему в следующий раз. 
    Мы можем разрешить эти подключения, набрав:
        # ufw allow OpenSSH
    После этого мы можем включить брандмауэр, набрав:
        # ufw enable
    Введите 'y' и нажмите ENTER, чтобы продолжить. Вы можете увидеть, что SSH-соединения по-прежнему разрешены, набрав:
        # ufw status
    Поскольку в настоящее время брандмауэр блокирует все соединения, кроме SSH, при установке и настройке дополнительных
    служб вам потребуется настроить параметры брандмауэра, чтобы разрешить прохождение приемлемого трафика. 
    Можно изучить некоторые распространенные операции UFW в руководстве по основам UFW, в файле SetUp_UFW.md
Шаг 5 — Включение внешнего доступа для вашего обычного пользователя
    Теперь, когда есть обычный пользователь для повседневного использования, нужно убедиться, что мы можем напрямую 
    подключиться к учетной записи SSH.
    Процесс настройки доступа SSH для вашего нового пользователя зависит от того, использует ли корневая учетная запись 
    вашего сервера пароль или ключи SSH для аутентификации.
    1. Если корневая учетная запись использует аутентификацию по паролю
    Если мы вошли в свою корневую учетную запись с помощью пароля, то аутентификация по паролю включена для SSH. 
    Можно использовать SSH для новой учетной записи пользователя, открыв новый сеанс терминала и используя SSH с вашим 
    новым именем пользователя:
        $ sammy@your_server_ip
    После ввода пароля вашего обычного пользователя вы войдете в систему. Помните, если вам нужно запустить команду с 
    правами администратора, введите sudo перед ней следующее:
        $ sudo command_to_run
    Вам будет предложено ввести пароль обычного пользователя при sudo первом использовании сеанса (и периодически).
    Чтобы повысить безопасность вашего сервера, мы настоятельно рекомендуем настроить ключи SSH вместо аутентификации по
    паролю. Следуйте руководству по настройке ключей SSH в Debian 11, чтобы узнать, как настроить аутентификацию на 
    основе ключей, в файле SetUp_SSH.md
    2. Если корневая учетная запись использует аутентификацию по ключу SSH
    Если вы вошли в свою учетную запись root, используя ключи SSH, то аутентификация по паролю для SSH отключена. 
    Вам нужно будет добавить копию вашего локального открытого ключа в ~/.ssh/authorized_keys файл нового пользователя, 
    чтобы успешно войти в систему.
    Поскольку ваш открытый ключ уже находится в файле корневой учетной записи ~/.ssh/authorized_keys на сервере, мы 
    можем скопировать этот файл и структуру каталогов в нашу новую учетную запись пользователя в нашем существующем 
    сеансе с помощью cp команды. После этого мы можем настроить права собственности на файлы с помощью chown команды.
    Обязательно измените выделенные части команды ниже, чтобы они соответствовали вашему обычному имени пользователя:
        # cp -r ~/.ssh /home/sammy
        # chown -R sammy:sammy /home/sammy/.ssh
    Команда cp -r копирует весь каталог в домашний каталог нового пользователя, а также chown -R изменяет владельца 
    этого каталога (и всего, что внутри него) на указанного username:groupname(по умолчанию Debian создает группу с тем 
    же именем, что и ваше имя пользователя).
    Теперь откройте новый сеанс терминала и войдите через SSH под своим новым именем пользователя:
        $ ssh sammy@your_server_ip
    Вы должны войти в новую учетную запись пользователя без использования пароля. Помните, если вам нужно запустить 
    команду с правами администратора, введите sudo перед ней вот так:
        $ sudo command_to_run
    Вам будет предложено ввести пароль обычного пользователя при sudo первом использовании каждого сеанса 
    (и периодически после этого).
    
    Куда пойти отсюда?
    На данный момент у вас есть прочная основа для вашего сервера. Теперь вы можете установить любое необходимое вам 
    программное обеспечение на свой сервер.

Исходники:
========================================================================================================================
https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-11